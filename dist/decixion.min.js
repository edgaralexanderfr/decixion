/**
 * Decixion Engine
 *
 * Version: 0.3.1
 * MIT License
 * Copyright (c) 2020 Edgar Alexander Franco
 */
var decixion={IS_MODULE:!1,_game:null,_players:{},_state:{},_rangeMin:0,_rangeMax:100,_currentSection:null,_countdown:0,_countdownInterval:null,_textEl:null,_countdownEl:null,_selectEl:null,_buttonEl:null,init:function(e){decixion._game=e,decixion._initPlayers(e),decixion._initState(e),decixion._initGame(e),decixion.select()},setRangeMin:function(e){decixion._rangeMin=e},setRangeMax:function(e){decixion._rangeMax=e},text:function(){return decixion._currentSection.text},countdown:function(){return decixion._countdown},options:function(){var e,n=[],i=decixion._currentSection.options,t=i.length;for(e=0;e<t;e++)n.push(i[e].text);return n},get:function(e,n){return n?decixion._players[n]?decixion._getObjectChain(decixion._players[n],e):void 0:decixion._getObjectChain(decixion._state,e)},set:function(e,n,i){return i?(decixion._players[i]||(decixion._players[i]={}),decixion._setObjectChain(decixion._players[i],e,n)):decixion._setObjectChain(decixion._state,e,n),n},increase:function(e,n,i,t){t=t||decixion._rangeMax;var o=decixion.get(e,i)+n;return t<o&&(o=t),decixion.set(e,o,i),o},decrease:function(e,n,i,t){t=t||decixion._rangeMin;var o=decixion.get(e,i)-n;return o<t&&(o=t),decixion.set(e,o,i),o},select:function(e){var n=decixion._game;if(decixion._clearCountdownInterval(),!decixion._currentSection)return decixion._currentSection=decixion._getObjectChain(n.sections,n.entrySection),!0;var i=decixion._currentSection;if(!i.options)return!1;e<0?e=0:e>=i.options.length&&(e=i.options.length-1);var t=i.options[e];return!!t.section&&(decixion._goToSection(t.section),!0)},call:function(e,n){var i=n||{};return decixion._getObjectChain(decixion._game.functions,e)(decixion,i)},each:function(e,n){if(Array.isArray(e)){var i,t=e.length;for(i=0;i<t;i++)n(i,e[i])}else{var o;for(o in e)n(o,e[o])}},bindtext:function(e){decixion._textEl=e,decixion._textEl.innerText=decixion.text()},unbindtext:function(){decixion._textEl=null},bindcountdown:function(e){decixion._countdownEl=e,0<decixion._countdown?decixion._countdownEl.innerText=decixion.countdown():decixion._countdownEl.innerText=""},unbindcountdown:function(){decixion._countdownEl=null},bindselect:function(e){decixion.unbindselect();var n=decixion._currentSection;decixion._selectEl=e,n&&n.options&&decixion._updateSelectElOptions(n.options),decixion._selectEl.addEventListener("change",decixion._onSelectElChange,!1)},unbindselect:function(){decixion._selectEl&&decixion._selectEl.removeEventListener("change",decixion._onSelectElChange,!1),decixion._selectEl=null},bindbutton:function(e){decixion.unbindbutton(),decixion._buttonEl=e,decixion._buttonEl.addEventListener("click",decixion._onButtonElClick,!1)},unbindbutton:function(){decixion._buttonEl&&decixion._buttonEl.removeEventListener("click",decixion._onButtonElClick,!1),decixion._buttonEl=null},_initPlayers:function(e){"object"==typeof e.players&&decixion._setRecursiveValues(decixion._players,e.players)},_initState:function(e){"object"==typeof e.state&&decixion._setRecursiveValues(decixion._state,e.state)},_initGame:function(e){"function"==typeof e.init&&e.init(decixion)},_getObjectChain:function(e,n){var i,t=n.split("."),o=t.length;for(i=0;i<o;i++){if(void 0===e[t[i]])return;e=e[t[i]]}return e},_setObjectChain:function(e,n,i){var t,o=n.split("."),c=o.length,d=c-1;for(t=0;t<c;t++)t==d?e[o[t]]=i:("object"!=typeof e[o[t]]&&(e[o[t]]={}),e=e[o[t]]);return i},_setRecursiveValues:function(e,n){var i,t,o,c,d=Array.isArray(n);for(i in n)t=n[i],(o=Array.isArray(t))||"object"==typeof t?(c=o?[]:{},decixion._setRecursiveValues(c,t),d?e.push(c):e[i]=c):d?e.push(t):e[i]=t},_goToSection:function(e){decixion._currentSection=decixion._getObjectChain(game.sections,decixion._evaluateGameValue(e));var n=decixion._currentSection;if(n.countdown){var i=n.countdown.section;decixion._countdown=n.countdown.time,decixion._countdownEl&&(decixion._countdownEl.innerText=decixion._countdown),decixion._countdownInterval=setInterval(function(){0==decixion._countdown?(clearInterval(decixion._countdownInterval),decixion._countdownInterval=null,decixion._countdownEl&&(decixion._countdownEl.innerText=""),decixion._goToSection(i),decixion._updateEls()):(decixion._countdown--,decixion._countdownEl&&(decixion._countdownEl.innerText=decixion._countdown))},1e3)}n.set&&decixion._evaluateStateValue(n.set,function(e){decixion.set(e.name,decixion._evaluateGameValue(e.value),e.player)}),n.increase&&decixion._evaluateStateValue(n.increase,function(e){decixion.increase(e.name,decixion._evaluateGameValue(e.value),e.player)}),n.decrease&&decixion._evaluateStateValue(n.decrease,function(e){decixion.decrease(e.name,decixion._evaluateGameValue(e.value),e.player)}),n.enter&&decixion._evaluateGameValue(n.enter),decixion._updateEls()},_updateEls:function(){decixion._textEl&&(decixion._textEl.innerText=decixion.text());var e=decixion._currentSection;decixion._selectEl&&(e.options?decixion._updateSelectElOptions(e.options):decixion._updateSelectElOptions([]))},_updateSelectElOptions:function(e){if(!decixion._selectEl)return null;var n,i,t=decixion._selectEl.length;for(n=t-1;0<=n;n--)decixion._selectEl.remove(n);for(t=e.length,n=0;n<t;n++)(i=document.createElement("option")).text=e[n].text,i.value=n,decixion._selectEl.appendChild(i);return decixion._selectEl},_evaluateStateValue:function(e,i){Array.isArray(e)||(e=[e]),decixion.each(e,function(e,n){i(n)})},_evaluateGameValue:function(e){if("function"==typeof e)return e(decixion);if(e.call){var n=e.args?e.args:{};return decixion.call(e.call,n)}return e},_clearCountdownInterval:function(){decixion._countdownInterval&&(clearInterval(decixion._countdownInterval),decixion._countdownInterval=null,decixion._countdown=0,decixion._countdownEl&&(decixion._countdownEl.innerText=""))},_onSelectElChange:function(e){decixion._selectEl&&decixion.select(decixion._selectEl.selectedIndex)},_onButtonElClick:function(e){decixion._selectEl&&decixion.select(decixion._selectEl.selectedIndex)}};decixion.IS_MODULE="undefined"!=typeof module,decixion.IS_MODULE&&(module.exports=decixion);